!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.bmDraftQueue=t()}(this,function(){"use strict";function e(e,t){var n=t||0,r=s;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]}function t(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var u=e.random||(e.rng||p)();if(u[6]=15&u[6]|64,u[8]=63&u[8]|128,t)for(var o=0;o<16;++o)t[r+o]=u[o];return t||g(u)}function n(){return function(){return b()}}function r(){var e="blinkDrafts",t=void 0;this.config=function(n){var r=n.dbName,u=void 0===r?"bmDrafts":r,o=n.appName;e=u,t=o},this.$get=["$rootScope","$localForage","uuidService",function(n,r,u){if(angular.isUndefined(t))throw new Error("You must specify an appName in your applications .config function before using this service");var o=r.createInstance({name:e,storeName:t,description:"Blink Mobile Draft Queue Storage"}),i=function(e,t){var n=(new Date).getTime();return{model:e,form:t,dateCreated:n,dateModified:n}},a=function(e){return n.$broadcast("bmDraftQueueAdd",e),e};return{setItem:function(e,t){if(!e)throw new Error("model must be defined");if(!t)throw new Error("formName must be defined");return e._uuid?o.getItem(e._uuid).then(function(n){if(!n)return o.setItem(e._uuid,i(e,t)).then(a);var r={model:e,form:n.form,dateCreated:n.dateCreated,dateModified:(new Date).getTime()};return o.setItem(e._uuid,r).then(a)}):(e._uuid=u(),o.setItem(e._uuid,i(e,t)).then(a))},getItem:function(e){return o.getItem(e)},removeItem:function(e){return o.removeItem(e).then(function(e){return n.$broadcast("bmDraftQueueRemove",e),e})},clear:function(){return o.clear()},iterate:function(e){return o.iterate(e)},length:function(){return o.length()},instance:function(){return o}}}]}function u(e,t,n,r,u){var o=this,i=[],a=!1;o.$onInit=function(){o.draftQueue=[],o.displayRemove||(o.displayRemove="&#x2718;"),o.displayRemove=n.trustAsHtml(o.displayRemove),i.push(e.$on("bmDraftQueueRemove",o.getQueue)),i.push(e.$on("bmDraftQueueAdd",o.getQueue)),o.getQueue()},o.$onDestroy=function(){i.forEach(function(e){return e()})},o.selectItem=function(e){o.onSelectItem&&o.onSelectItem({item:e})};var f=function(e){return u.removeItem(e).then(o.getQueue)};o.removeItem=function(e){return o.onRemoveItem?u.getItem(e).then(function(e){return o.onRemoveItem({item:e})}).then(f).catch(function(){return!1}):r.confirm("Are you sure you want to remove this item?")?f(e):void 0},o.getQueue=function(){if(a)return Promise.resolve();a=!0;var e=o.draftQueue||[];return o.draftQueue.length=0,u.iterate(function(e){o.draftQueue.push(e)}).catch(function(){return o.draftQueue=e}).then(function(){return a=!1})},o.clear=function(){return u.clear()}}function o(e,t,n){var r=function(e){return["POST","PUT"].indexOf(e)>-1},u=function(e){return e.toLowerCase().indexOf("application/x-www-form-urlencoded")>-1},o=function(e){return e.toLowerCase().indexOf("json")>-1},i=function(e){return r(e.method.toUpperCase())&&(u(e.headers["Content-Type"])||o(e.headers["Content-Type"]))};return{response:function(e){return e.config&&i(e.config)&&e.config.data&&e.config.data._uuid?n.removeItem(e.config.data._uuid).then(function(){return e}):e}}}var i,a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},f=a.crypto||a.msCrypto;if(f&&f.getRandomValues){var c=new Uint8Array(16);i=function(){return f.getRandomValues(c),c}}if(!i){var m=new Array(16);i=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),m[t]=e>>>((3&t)<<3)&255;return m}}for(var d=i,s=[],l=0;l<256;++l)s[l]=(l+256).toString(16).substr(1);var v=e,p=d,g=v,h=t,b=h,Q=n,y=r;u.$inject=["$scope","$q","$sce","$window","bmDraftQueueService"];var I={controller:u,controllerAs:"DraftQueueListCtrl",template:'<div class="bm-draft-queue">\n  <ul class="bm-draft-queue__list">\n    <li class="bm-draft-queue__list-item" ng-repeat="item in DraftQueueListCtrl.draftQueue">\n      <a  class="bm-draft-queue__select-item"\n          title="Select item"\n          href=""\n          ng-click="DraftQueueListCtrl.selectItem(item.model)">{{item.form}} - Created at {{item.dateCreated | date:\'hh:mm dd/MMM/y\'}}</a>\n      <a class="bm-draft-queue__remove-item bm-button__icon"\n         href=""\n         title="Remove Item"\n         ng-click="DraftQueueListCtrl.removeItem(item.model._uuid)"\n         ng-bind-html="DraftQueueListCtrl.displayRemove"></a>\n    </li>\n  </ul>\n\n  <a href="" class="bm-draft-queue__clear"\n     ng-click="DraftQueueListCtrl.clear()"> Remove all</a>\n</div>\n',bindings:{displayRemove:"@?",onSelectItem:"&?",onRemoveItem:"&?"}};o.$inject=["$window","$q","bmDraftQueueService"];var w=o,D=Q,_=y,$=I,C=w;return angular.module("bmDraftQueue",["LocalForageModule"]).config(["$httpProvider",function(e){e.interceptors.push("bmDraftQueueInterceptor")}]).provider("bmDraftQueueService",_).factory("bmDraftQueueInterceptor",C).service("uuidService",D).component("draftQueueList",$),{}});